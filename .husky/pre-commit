# ImmoLink Pre-Commit Hook Configuration

echo "ğŸ” Running Flutter pre-commit checks..."

# Change to Flutter project directory
cd immolink || exit 1

# 1. Format code
echo "âœ¨ Formatting Dart code..."
dart format . --set-exit-if-changed || {
  echo "âš ï¸  Code was auto-formatted. Re-staging files..."
  dart format .
  git add -u
}

# 2. Analyze code (only errors/warnings, not infos)
echo "ğŸ” Running Flutter analyze..."
flutter analyze --fatal-warnings || {
  echo "âŒ Flutter analyze found critical issues!"
  exit 1
}

# 3. Run tests
echo "ğŸ§ª Running tests..."
flutter test --coverage || {
  echo "âŒ Tests failed!"
  exit 1
}

# 4. Check for unused imports (via custom script)
echo "ğŸ§¹ Checking for unused imports..."
dart run scripts/check_unused_imports.dart || {
  echo "âš ï¸  Found unused imports (auto-fixing...)"
  dart run scripts/fix_unused_imports.dart
  git add -u
}

# 5. Security: Check pubspec.lock for known vulnerabilities
echo "ğŸ”’ Running security checks..."
# Future: Add dart pub outdated --mode=null-safety check

echo "âœ… All pre-commit checks passed!"
