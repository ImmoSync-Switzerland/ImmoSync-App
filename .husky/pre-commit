# ImmoLink Pre-Commit Hook Configuration

echo "ğŸ” Running Flutter pre-commit checks..."

# Change to Flutter project directory
cd immolink || exit 1

# 1. Format code
echo "âœ¨ Formatting Dart code..."
dart format . --set-exit-if-changed || {
  echo "âš ï¸  Code was auto-formatted. Re-staging files..."
  dart format .
  git add -u
}

# 2. Auto-fix lint issues (prefer_const_constructors, etc.)
echo "ğŸ”§ Auto-fixing lint issues..."
dart fix --apply || {
  echo "âš ï¸  Some fixes applied, re-staging..."
  git add -u
}

# 3. Analyze code (only fail on errors, not warnings/infos)
echo "ğŸ” Running Flutter analyze..."
flutter analyze || {
  echo "âŒ Flutter analyze found errors!"
  exit 1
}

# 4. Run tests
echo "ğŸ§ª Running tests..."
flutter test --coverage || {
  echo "âŒ Tests failed!"
  exit 1
}

# 5. Check for unused imports (via custom script)
echo "ğŸ§¹ Checking for unused imports..."
dart run scripts/check_unused_imports.dart || {
  echo "âš ï¸  Found unused imports (auto-fixing...)"
  dart run scripts/fix_unused_imports.dart
  git add -u
}

# 6. Security: Check pubspec.lock for known vulnerabilities
echo "ğŸ”’ Running security checks..."
# Future: Add dart pub outdated --mode=null-safety check

echo "âœ… All pre-commit checks passed!"
