version: '3.8'
services:
  synapse:
    image: matrixdotorg/synapse:latest
    container_name: matrix-synapse
    restart: unless-stopped
    environment:
      - SYNAPSE_SERVER_NAME=localhost
      - SYNAPSE_REPORT_STATS=no
      - SYNAPSE_NO_TLS=true
      - SYNAPSE_ENABLE_REGISTRATION=no
      - SYNAPSE_REGISTRATION_SHARED_SECRET=dev_shared_secret_change_me
      - SYNAPSE_APPSERVICE_REGISTRATION_DIR=/data/appservices
      - SYNAPSE_LOG_LEVEL=INFO
    volumes:
      - synapse-data:/data
    ports:
      - "8008:8008" # client-server API
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8008/_matrix/client/versions"]
      interval: 30s
      timeout: 5s
      retries: 5

  element:
    image: vectorim/element-web:latest
    container_name: matrix-element
    restart: unless-stopped
    ports:
      - "8082:80"
    environment:
      - CONFIG_JSON=/app/config.json
    volumes:
      - element-config:/app
    depends_on:
      - synapse

volumes:
  synapse-data:
  element-config:
